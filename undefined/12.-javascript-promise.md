# âž¡ 12. í”„ë¡œë¯¸ìŠ¤ ê°œë…ë¶€í„° í™œìš©ê¹Œì§€JavaScript Promise

## **ðŸ’¡promise**

* ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ìˆ˜í–‰í• ë–„ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ì— ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìžˆëŠ” ì˜¤ë¸Œì íŠ¸
* State(ìƒíƒœ): pendding â†’ fulfilled or rejected
* Producer(ì œê³µ) vs. Consumer(í•„ìš”í•˜ëŠ” ì‚¬ëžŒ)

```javascript
'use strict';

// Promise is a JavaScrit object for asynchronous operation. ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ìˆ˜í–‰í• ë–„ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ì— ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìžˆëŠ” ì˜¤ë¸Œì íŠ¸
// State(ìƒíƒœ): pendding â†’ fulfilled or rejected
// Producer(ì œê³µ) vs. Consumer(í•„ìš”í•˜ëŠ” ì‚¬ëžŒ)


// 1. Producer
// When new Promise is created, the executor runs automatically.
const promise = new Promise((resolve, reject) => {
  // doing some heavy work (network, read files - ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ”ê²ƒì´ ì¢‹ìŒ)
  console.log('doing something...');
  setTimeout(() => {
    resolve('ellie');
    // reject(new Error('no network'));
  }, 2000);
});



// 2. Consumer: then, catch, finally
// ì£¼ì˜: then, catch, finallyëŠ” í•œ êµ¬ë¬¸ì´ë¼, ëì—ë§Œ ; (ì„¸ë¯¸ì½œë¡ ) ë¶™ìž„.
promise
  .then((value) => {
    // ì„±ê³µ ì‹œ ì‹¤í–‰
    console.log(value);
  })

  .catch((error) => {
    // ì‹¤íŒ¨ ì‹œ ì‹¤í–‰
    console.log(error);
  })

  .finally(() => {
    // ì„±ê³µãƒ»ì‹¤íŒ¨ ì‹œ ì‹¤í–‰
    console.log('finally');
  });



// 3. Promise chaining
const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});


fetchNumber
  .then((num) => num * 2) // 1 => 1*2 = 2
  .then((num) => num * 3) // 2 => 2*3 = 6
  .then((num) => {
    return new Promise((resolve, reject) => {
      setTimeout(() => resolve(num - 1), 1000); // 6 - 1 = 5
    });
  })
  .then((num) => console.log(num)); // 5 => 5

// thenì€ valueë¥¼ ì „ë‹¬í•  ìˆ˜ë„ ìžˆê³ , Promise ìžì²´ë¥¼ ì „ë‹¬í•  ìˆ˜ë„ ìžˆìŒ.
// ì´ 2ì´ˆ ì†Œìš”.
// ê²°ê³¼ê°’: 5
// ë¹„ë™ê¸° ì½”ë“œë“¤ì„ ë¬¶ì–´ì„œ (= chaining) í‘œí˜„ ê°€ëŠ¥.



// Promiseë¥¼ chainingí–ˆì„ ë•Œ Error ë‹¤ë£¨ëŠ” ë²• ì†Œê°œ.
// 4. Error Handling
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('ë‹­'), 1000);
  });

const getEgg = (hen) =>
  new Promise((resolve, reject) => {
    //setTimeout(() => resolve(`${hen} => ë‹¬ê±€`), 1000); // ì„±ê³µ ì‹œ
    setTimeout(() => reject(new Error(`error! ${hen} => ë‹¬ê±€`)), 1000); // ì‹¤íŒ¨ ì‹œ
  });

const cook = (egg) =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => í›„ë¼ì´`), 1000);
  });



// ******************************************

// const getEgg ë¶€ë¶„ì—ì„œ ì„±ê³µ ì½”ë“œ ì‚¬ìš© ê°€ì • ì‹œ

// ******************************************

/*
getHen() // ë‹­
  .then((hen) => getEgg(hen)) // ë‹­ => ë‹¬ê±€
  .then((egg) => cook(egg)) // ë‹­ => ë‹¬ê±€ => í›„ë¼ì´
  .then((meal) => console.log(meal)); // ì¶œë ¥: ë‹­ => ë‹¬ê±€ => í›„ë¼ì´


// ë°›ì•„ì˜¨ value í•˜ë‚˜ë¥¼ ê·¸ëŒ€ë¡œ ë‹¤ë¥¸ í•¨ìˆ˜ì˜ ë…ë¦½ë³€ìˆ˜ë¡œ ì‚¬ìš© ì‹œ ì•„ëž˜ì²˜ëŸ¼ í‘œí˜„ ê°€ëŠ¥.
getHen() // ë‹­
  .then(getEgg) // ë‹­ => ë‹¬ê±€
  .then(cook) // ë‹­ => ë‹¬ê±€ => í›„ë¼ì´
  .then(console.log); // ì¶œë ¥: ë‹­ => ë‹¬ê±€ => í›„ë¼ì´


// ìœ„ ì¶•ì•½ëœ ì½”ë“œë¥¼ ì•„ëž˜ì²˜ëŸ¼ í•œ ì¤„ë¡œ í‘œí˜„ ê°€ëŠ¥.
getHen().then(getEgg).then(cook).then(console.log); // ì¶œë ¥: ë‹­ => ë‹¬ê±€ => í›„ë¼ì´
*/



// ìœ„ì²˜ëŸ¼ í•œ ì¤„ë¡œ í•˜ë©´ ê°€ë…ì„± ë–¨ì–´ì§€ë¯€ë¡œ, ì•„ëž˜ì²˜ëŸ¼ // ë¶™ì´ê³  Enterí‚¤ ëˆ„ë¥´ë©´ ìžë™ ì¤„ë°”ê¿ˆ ë¨.
getHen() //
  .then(getEgg)
  .then(cook)
  .then(console.log); // ì„±ê³µ ì‹œ ì¶œë ¥: ë‹­ => ë‹¬ê±€ => í›„ë¼ì´



// ******************************************

// const getEgg ë¶€ë¶„ì—ì„œ ì‹¤íŒ¨ ì½”ë“œ ì‚¬ìš© ê°€ì • ì‹œ

// ******************************************

// ì—ëŸ¬ ëŒ€ë¹„ ì½”ë“œ ì‚¬ìš© X
getHen() //
  .then(getEgg)
  .then(cook)
  .then(console.log)
  .catch(console.log); // ì¶œë ¥: Error: error! ë‹­ => ë‹¬ê±€



// ì—ëŸ¬ ëŒ€ë¹„ ì½”ë“œ ì‚¬ìš© O
getHen() //
  .then(getEgg)
  .catch((error) => {
    // ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ì½”ë“œ
    return 'ë¹µ';
  })
  .then(cook)
  .then(console.log)
  .catch(console.log); // ì¶œë ¥: ë¹µ => í›„ë¼ì´
```

****

{% content-ref url="11..md" %}
[11..md](11..md)
{% endcontent-ref %}

**ðŸ’¡**ìœ„ ì½”ë“œë¥¼ promiseì‚¬ìš©í•˜ì—¬ ì•„ëž˜ì²˜ëŸ¼

```javascript
'use strict';

// Callback Hell Escape by using Promise

class UserStorage {
  loginUser(id, password) {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        if (
          (id === 'ellie' && password === 'dream') ||
          (id === 'coder' && password === 'academy')
        ) {
          resolve(id);
        } else {
          reject(new Error('not found'));
        }
      }, 2000);
    });
  }



  getRoles(user) {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        if (user === 'ellie') {
          resolve({ name: 'ellie', role: 'admin' });
        } else {
          reject(new Error('no access'));
        }
      }, 1000);
    });
  }
}



const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = prompt('enter your password');

userStorage
  .loginUser(id, password)
  .then(userStorage.getRoles) // ì˜ë¯¸: .then(user => userStorage.getRoles(user))
  .then((user) => alert(`Hello ${user.name}, you have a ${user.role} role.`))
  .catch(console.log);
```
